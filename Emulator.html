<!DOCTYPE HTML>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="darkreader-lock">
    <meta name="title" content="Nightfall">
    <meta name="description" content="silly proxy">
    <meta property="og:title" content="Nightfall">
    <meta property="og:description" content="silly proxy">
    <meta property="og:image" content="https://dyinghynixmlc.github.io/Nightfall/assets/icon.ico">
    <meta property="og:image:width" content="1600">
    <meta property="og:image:height" content="1500">
    <title>Nightfall Proxy</title>
    <link rel="icon" href="https://dyinghynixmlc.github.io/Nightfall/assets/icon.ico" type="image/x-icon">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <img src="https://dyinghynixmlc.github.io/Nightfall/assets/bg_rm_rf.png" alt="Nightfall Logo">
        </div>
        <div class="title"><b>Emulator</b></div>
        <nav class="nav-links">
            <a href="https://dyinghynixmlc.github.io/Nightfall">Home</a>
            <a href="https://dyinghynixmlc.github.io/Nightfall/games.html">Games</a>
            <a href="https://dyinghynixmlc.github.io/Nightfall/settings.html">Settings</a>
            <a href="https://dyinghynixmlc.github.io/Nightfall/Emulator.html">Emulator</a>
        </nav>
    </header>

    <div id="top">
        <h1>Upload a ROM to Play</h1>
    </div>

    <div id="box">
        <input type="file" id="input" accept=".nes,.snes,.gba,.gb,.genesis">
    </div>

    <div class="emulator-container">
        <canvas id="emulatorCanvas" width="640" height="480"></canvas>
    </div>

    <script>
        let emulator;

        function loadEmulator() {
            const script = document.createElement("script");
            script.src = "./assets/loader.js";
            script.onload = () => {
                emulator = new EmulatorJS({
                    canvas: document.getElementById("emulatorCanvas"),
                    systems: ["nes", "snes", "gba", "gb", "genesis"]
                });

                emulator.initialize().then(() => {
                    console.log("Emulator initialized");
                });
            };
            document.body.appendChild(script);
        }

        document.getElementById("input").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file && emulator) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const romData = new Uint8Array(e.target.result);
                    emulator.loadROM(romData).then(() => {
                        emulator.start();
                        console.log("ROM loaded and started");
                    });
                };
                reader.readAsArrayBuffer(file);
            } else {
                console.error("Emulator not loaded yet!");
            }
        });

        window.onload = loadEmulator;
    </script>

    <footer class="footer">
        <span>Made with HATE by the <a href="https://github.com/DyingHynixMLC/Nightfall">Nightfall</a> team</span>
    </footer>
</body>
</html>
